# This is for local dev (e.g. laptop) development
services:
  v-db-juniper010725:
    image: postgres:16-alpine
    container_name: v-db-juniper010725
    env_file:
      - ./v-db-juniper010725/.env-db.example
    ports:
      - "5432:5432"
    volumes:
      # Bind mounts - directories from the host mapped into the container
      - ./v-db-juniper010725/pg-data-vendure-juniper:/var/lib/postgresql/data
    networks:
      dockernet-vendure-juniper:
        aliases:
          - vendure-database # Adding alias to reference in project so container names can be changed if desired. Aliases might appear in project code (particularly the database alias-- used as database host name.)

  v-srv-juniper010725:
    build:
      context: ./my-shop-juniper/apps/server
      dockerfile: Dockerfile.server
      target: dev # runs dev stage in its Dockerfile-- which includes CMD. Prod stage will be run via CICD
    ports:
      - 3000:3000
      - 5173:5173
    volumes:
      # Mount source code for hot reload
      - ./my-shop-juniper/apps/server:/usr/src/app
      # Prevent overwriting node_modules and build artifacts from container
      - /usr/src/app/node_modules
      - /usr/src/app/dist
    env_file:
      - ./my-shop-juniper/apps/server/.env.example.srv-wrk
    networks:
      dockernet-vendure-juniper:
        aliases:
          - vendure-server # Adding alias to reference in project so container names can be changed if desired. Aliases might appear in project code (particularly the database alias-- used as database host name.)

  v-wrk-juniper010725:
    build:
      context: ./my-shop-juniper/apps/server
      dockerfile: Dockerfile.worker
      target: dev # runs dev stage in its Dockerfile-- which includes CMD. Prod stage will be run via CICD
    # No ports exposed - worker only processes background jobs via job queue (accessed from DB rather than backend server)
    volumes:
      # Mount source code for hot reload
      - ./my-shop-juniper/apps/server:/usr/src/app
      # Prevent overwriting node_modules and build artifacts from container
      - /usr/src/app/node_modules
      - /usr/src/app/dist
    env_file:
      - ./my-shop-juniper/apps/server/.env.example.srv-wrk
    networks:
      dockernet-vendure-juniper:
        aliases:
          - vendure-worker # Adding alias to reference in project so container names can be changed if desired. Aliases might appear in project code (particularly the database alias-- used as database host name.)

  v-storefront-juniper010725:
    build:
      context: ./my-shop-juniper/apps/storefront
      dockerfile: Dockerfile.storefront
      target: dev # runs dev stage in its Dockerfile-- which includes CMD. Prod stage will be run via CICD
    ports:
      - 3001:3001  # Storefront accessible at localhost:3001
    volumes:
      # Mount source code for hot reload
      - ./my-shop-juniper/apps/storefront:/app
      # Prevent overwriting node_modules and build artifacts from container
      - /app/node_modules
      - /app/.next
    env_file:
      - ./my-shop-juniper/apps/storefront/.env.storefront.example
    networks:
      dockernet-vendure-juniper:
        aliases:
          - vendure-storefront # Adding alias to reference in project so container names can be changed if desired. Aliases might appear in project code (particularly the database alias-- used as database host name.)

networks:
  dockernet-vendure-juniper:
    name: dockernet-vendure-juniper